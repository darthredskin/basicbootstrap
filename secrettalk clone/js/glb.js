var ErrorTagNoSymbol="Sorry, no special symbols and punctuations are allowed.";function isMobile(){if(typeof window.orientation!="undefined"){return false}else{return true}}function cfm(c,a){var b=$(c);b.hide().after('<span style="background:#f8f8f8;padding:0 3px;color:#999"><a href="#">'+yes+'</a> / <a href="#">'+no+"</a></span>");$("#"+b.attr("id")+" + span > a:first").click(function(){a(b);return false});$("#"+b.attr("id")+" + span > a:last").click(function(){b.show();$(this).parent().remove();return false})}(function(g){g.each(["backgroundColor","color"],function(a,b){g.fx.step[b]=function(c){if(c.state==0){c.start=h(c.elem,b);c.end=e(c.end)}c.elem.style[b]="rgb("+[Math.max(Math.min(parseInt((c.pos*(c.end[0]-c.start[0]))+c.start[0]),255),0),Math.max(Math.min(parseInt((c.pos*(c.end[1]-c.start[1]))+c.start[1]),255),0),Math.max(Math.min(parseInt((c.pos*(c.end[2]-c.start[2]))+c.start[2]),255),0)].join(",")+")"}});function e(a){var b;if(a&&a.constructor==Array&&a.length==3){return a}if(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a)){return[parseInt(b[1]),parseInt(b[2]),parseInt(b[3])]}if(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(a)){return[parseFloat(b[1])*2.55,parseFloat(b[2])*2.55,parseFloat(b[3])*2.55]}if(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a)){return[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}if(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a)){return[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]}return f[g.trim(a).toLowerCase()]}function h(a,c){var b;do{b=g.curCSS(a,c);if(b!=""&&b!="transparent"||g.nodeName(a,"body")){break}c="backgroundColor"}while(a=a.parentNode);return e(b)}var f={white:[255,255,255]}})(jQuery);jQuery.fmt=function(){var c=arguments[0];for(var a=0;a<arguments.length-1;a++){var b=new RegExp("\\{"+a+"\\}","gm");c=c.replace(b,arguments[a+1])}return c};jQuery.fn.lc=function(b,a,c){$(this).each(function(){var f=$(this).attr("value");var e=0;if(f){e=f.length}var d=b-e;if(c==null){$(this).after('<span class="lenChk"></span>')}else{$(this).closest("form").find(c).after('<span class="lenChk"></span>')}$(this).keyup(function(g){var k=$(this).attr("value");var j=0;if(k){j=k.length}var h=b-j;if(c==null){$(this).next(".lenChk").html($.fmt(a,"<b>"+h.toString()+"</b>")).show()}else{$(this).closest("form").find(".lenChk").html($.fmt(a,"<b>"+h.toString()+"</b>")).show()}return this})});return this};function loadClose(){$("#btnModalClose").click(function(){$("#mask").remove();$("#modal").remove();$("select").css("visibility","visible")})}function lnkConv(b,c){var a='<input type="hidden" name="opener_form_id" value="'+c+'" />';if(c!=null){if(b.find('input[name$="opener_form_id"]').length==0){b.find("form").prepend(a)}}b.find("a").click(function(){$("#mdContent").load($(this).attr("href")+"  #win",null,function(){lnkConv(b,c);if(c!=null){if(b.find('input[name$="opener_form_id"]').length==0){b.find("form").prepend(a)}}});return false})}function redir(g){$("select").css("visibility","hidden");$("body").append('<div id="mask"></div><div id="modal" class="modalRedir"></div>');var b=$("#mask");var c=$("#modal");var d=$(document).height();var f=$(window).width();var a=$(window).height();var e=$(window).scrollTop();b.css({width:f,height:d});b.show();c.css({left:f/2-c.outerWidth()/2,top:a/2-90+e+"px"});c.fadeIn(300,function(){g()})}function modal(h,e,k,f){$("select").css("visibility","hidden");$("body").append('<div id="mask" style="position:absolute;z-index:9999;display:none;top:0;left:0;background:#000;filter:alpha(Opacity=30);opacity:.3;-moz-opacity:.3;-khtml-opacity:.3;"></div><div id="modal" class="modal row-fluid" style="min-width:230px;max-width:530px;z-index:99999;position:absolute;float:left;display:none;overflow:hidden;margin:0" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-header" style="padding:3px 15px;height:26px"><button id="btnModalClose" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button></div><div id="mdContent" style="padding:9px 12px;"><div class="loadingAuto"></div></div></div>');var m=$("#mask");var i=$("#modal");var j=$(document).height();var g=$(window).width();var b=$(window).height();var c=$("#mdContent");var d=$(window).scrollTop();m.css({width:g,height:j});m.show();loadClose();switch(h){default:var l=g/2-i.outerWidth()/2;if(l<0){l=0}i.css({left:l+"px",top:d+12+"px"});i.fadeIn();var a;if(f==null){a="/signup"}else{a=f}c.load(a+" #win",null,function(){if(h==0){lnkConv(c)}else{lnkConv(c,k)}});break;case 2:i.css({left:g/2-i.outerWidth()/2+"px",top:d+(b/3)+"px"}).removeClass("modalWin").addClass("modalMsg");c.html('<div style="padding:9px;"><div class="alert alert-error">'+e+"</div></div>");i.fadeIn();break}}function pli(){for(var a=0;a<arguments.length;a++){$("<img />").attr("src","http://e.cdn1.org/p/"+arguments[a])}}pli("ico/loading.gif");function sbmt(obj){var frm=$(obj);var btn=frm.find("input[type='submit']");if(frm.find(".loading").length==0){btn.after('<div class="loading"></div>')}var load=frm.find(".loading");btn.blur();$.ajax({url:frm.attr("action"),type:"POST",dataType:"json",data:frm.serialize(),beforeSend:function(){btn.attr("disabled","disabled");load.show()},success:function(j){btn.removeAttr("disabled");load.hide();if(j.ok==0){if(frm.find(".alert-error").length==0){frm.prepend('<div class="alert alert-error hide"></div>')}var dlgErr=frm.find(".alert-error");var msgErr=frm.find(".c-error-message-item");dlgErr.html("<ul></ul>");$.each(j.d,function(n,v){var fieldLine=frm.find("*[name="+this.n+"]").parent();var errMsgElement=fieldLine.next();dlgErr.find("ul").append('<li><i class="icon-remove-sign"></i> '+this.v+"</li>");errMsgElement.show()});dlgErr.fadeIn();if(dlgErr.length>0){}}else{frm.find(".alert-error").hide();switch(j.d.n){case 0:eval(j.d.v);break;case 1:modal(1,null,frm.attr("id"));break;case 2:frm.html('<div class="alert alert-success">'+j.d.v+"</div>");break;case 3:location.href=j.d.v;break;case 4:$("#btnModalClose").trigger("click");sbmt($("#"+j.d.v));break;case 5:$("#btnModalClose").trigger("click");redir(function(){location.reload()});break;case 6:$(j.d.ep).load(j.d.v+" "+j.d.ec);break;case 7:var lastItem=$(j.d.eta+" > "+j.d.ei+":last");if(lastItem.length>0){lastItem.after(j.d.v)}else{$(j.d.eta).prepend(j.d.v)}if(j.d.ehf==1){$(j.d.etcu).closest("form").hide()}else{$(j.d.etcu).val("");$(j.d.etcu).closest("form").find(".lenChk").hide()}$(j.d.eta+" > "+j.d.ei+":last").slideDown(300).hlt('div[class^="ctt "]');break}}},error:function(xhr){load.hide();btn.removeAttr("disabled");modal(2,xhr.responseText)}})}$("#nav").ready(function(){$("#frmSch").submit(function(){if($("#uniSchQ").val()==""){return false}else{return true}})});function updateCmtAmt(b){var a=$("#commentAmount");if(a.length>0){var e=a.find("span").text();var c=parseInt(e)+b;var d=commentsSingular;if(c==0||c>1){d=commentsPlural}a.fadeOut(600,function(){a.html("<span>"+c+"</span> "+d);a.fadeIn(600)})}}function updateComment(b){var a=$("#editComment-"+b).parent().parent().prev();a.html(a.find("textarea").val().replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/gi,"<br />"))}function addComment(b,a){$("#commentList").prepend(a);$("#comment_content").val("");$("html, body").animate({scrollTop:$("#commentList").offset().top-113},900);$("#item-"+b).fadeIn(399,function(){updateCmtAmt(1)})}$(function(){$("#btnCloseSearch").click(function(){$(".site-search").fadeOut();$("#btnSiteSearch").removeClass("active");return false});$("#btnSiteSearch").click(function(){$(".site-search").fadeIn();$("#btnSiteSearch").addClass("active");return false});$("body").on("click","a[id^=editComment]",function(){id=$(this).attr("id").split("-")[1];if(id=="0"){location.href="/post/"+postId}else{var b=$(this).parent().parent().prev();if(b.find("p").length==0){var e=/<br>/gi;var d=b.html().replace(e,"\n");var c=$("#postSave").val();b.html('<form method="post" action="/comments/update?id='+id+'"><p><textarea name="content" style="width:95%;height:90px;margin-bottom:3px">'+d+'</textarea></p><p><input class="btn btn-success" value="'+c+'" type="submit"></p></form>')}}return false});$("body").on("click","a[id^=delComment]",function(){id=$(this).attr("id").split("-")[1];if(id=="0"){a(this,postId,"/posts/delete")}else{a(this,id,"/comments/delete")}return false});$("a[id^=delPost]").click(function(){var b=$(this).attr("id").split("-")[1];a(this,b,"/posts/delete");return false});$("a[id^=resetPost]").click(function(){var b=$(this).attr("id").split("-")[1];a(this,b,"/api/resetpostflag");return false});$("a[id^=resetComment]").click(function(){var b=$(this).attr("id").split("-")[1];a(this,b,"/api/resetcommentflag");return false});function a(c,d,b){cfm(c,function(e){updateCmtAmt(-1);e.next("span").text(wait);$.post(b,{id:d,r:(new Date()).getTime()},function(f){if(f.ok==1){switch(f.d.n){case 0:e.next("span").remove();e.show();modal(0,null);break;case 6:e.next("span").remove();e.show();modal(2,f.d.v);break;default:item=$("#item-"+d);if(item.length>0){item.fadeOut()}else{location.href="/"}break}}},"json")})}$.getScript("http://e.cdn1.org/i/plg.js",function(){$("#TagInput").autoSuggest("/core/tagsuggest",{neverSubmit:"true",keyDelay:300,preFill:$("#Tags").val(),asHtmlID:"TagInput"})});$('a[target-mode="modal"]').click(function(){modal(1,null,null,$(this).attr("href"));return false})});$(document).on("submit","form[mode!=traditional]",function(){sbmt(this);return false});$(".navbar").on("click","#signup",function(){modal(0,null);return false});$(".navbar").on("click","#login",function(){modal(0,null,null,$(this).attr("href"));return false});$(".navbar").on("submit","#btnUniSch",function(){$("#frmSch").submit();return false});function sl(a){location.href="/account/switchlang?lang="+a+"&r="+encodeURI(location.href)}function toDBC(c){var a="";c=c.replace(/。/g,"．").replace(/“/g,"．").replace(/”/g,"．");for(var b=0;b<c.length;b++){code=c.charCodeAt(b);if(code>=65281&&code<=65373){a+=String.fromCharCode(c.charCodeAt(b)-65248)}else{if(code==12288){a+=String.fromCharCode(c.charCodeAt(b)-12288+32)}else{a+=c.charAt(b)}}}return a}String.prototype.startsWith=function(a){return(this.substr(0,a.length)===a)};$("body").ready(function(){$.each(vts,function(){var e=$(".vote input[value="+this.c+"]");e.parent(".vote-up").addClass("vote-up-c")});function d(g,e,f){if(g==1){f.text(parseInt(f.text())-1);e.toggleClass("vote-up-c")}else{f.text(parseInt(f.text())+1);e.toggleClass("vote-dn-c")}}function c(h,k,f){var i;var e;var g=$(f);i=g.find(".vote-sum");e=parseInt(i.text());if(g.hasClass("vote-up-c")){e--}else{e++}g.toggleClass("vote-up-c");i.text(e);$.post("/api/vote",{c:h,p:postId,m:k,r:(new Date()).getTime()},function(l){if(l){switch(l.d.n){case 0:d(k,g,i);modal(0,null);break;case 6:d(k,g,i);modal(2,l.d.v);break}}},"json");var j=i.nextAll("input")}var b=$("div[class^=vote-up]");$("a[id^=rpt]").click(function(){cfm(this,function(g){var f=g.attr("id").split("-");var e=f[1];g.next("span").text(wait);$.post("/api/report",{p:postId,c:e,r:(new Date()).getTime()},function(h){if(h.ok==1){switch(h.d.n){case 0:g.next("span").remove();g.show();modal(0,null);break;case 6:g.next("span").remove();g.show();modal(2,h.d.v);break;default:g.next("span").text(flagged);break}}},"json")});return false});function a(e){return $(e).find("input").val()}$("body").on("click",".vote",function(){c(a(this),true,this)})});